<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AccountFactory.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Finance App Refactoring</a> &gt; <a href="index.source.html" class="el_package">com.university.finance.pattern.factory</a> &gt; <span class="el_source">AccountFactory.java</span></div><h1>AccountFactory.java</h1><pre class="source lang-java linenums">package com.university.finance.pattern.factory;

import com.university.finance.model.Account;
import com.university.finance.model.User;

import java.util.UUID;

/**
 * Factory pour la création de comptes bancaires.
 * Implémente le pattern Factory pour centraliser la création d'objets Account
 * avec validation des données.
 */
<span class="fc" id="L13">public class AccountFactory {</span>

    // Dépôt initial minimum
    private static final double MIN_INITIAL_DEPOSIT = 0.0;

    // Dépôt initial maximum
    private static final double MAX_INITIAL_DEPOSIT = 1000000.0;

    /**
     * Crée un nouveau compte avec un ID généré automatiquement.
     *
     * @param owner          Propriétaire du compte
     * @param initialDeposit Dépôt initial
     * @return Le nouveau compte créé
     * @throws IllegalArgumentException si les données sont invalides
     */
    public Account createAccount(User owner, double initialDeposit) {
<span class="fc" id="L30">        validateOwner(owner);</span>
<span class="fc" id="L31">        validateInitialDeposit(initialDeposit);</span>

<span class="fc" id="L33">        String id = generateAccountId();</span>
<span class="fc" id="L34">        return new Account(id, owner, initialDeposit);</span>
    }

    /**
     * Crée un nouveau compte avec un ID spécifique.
     *
     * @param id             Identifiant du compte
     * @param owner          Propriétaire du compte
     * @param initialDeposit Dépôt initial
     * @return Le nouveau compte créé
     * @throws IllegalArgumentException si les données sont invalides
     */
    public Account createAccount(String id, User owner, double initialDeposit) {
<span class="fc bfc" id="L47" title="All 4 branches covered.">        if (id == null || id.trim().isEmpty()) {</span>
<span class="fc" id="L48">            throw new IllegalArgumentException(&quot;L'ID du compte ne peut pas être vide&quot;);</span>
        }
<span class="fc" id="L50">        validateOwner(owner);</span>
<span class="fc" id="L51">        validateInitialDeposit(initialDeposit);</span>

<span class="fc" id="L53">        return new Account(id, owner, initialDeposit);</span>
    }

    /**
     * Crée un compte avec un solde initial de zéro.
     *
     * @param owner Propriétaire du compte
     * @return Le nouveau compte créé
     */
    public Account createEmptyAccount(User owner) {
<span class="fc" id="L63">        validateOwner(owner);</span>
<span class="fc" id="L64">        String id = generateAccountId();</span>
<span class="fc" id="L65">        return new Account(id, owner, 0.0);</span>
    }

    /**
     * Crée un compte premium avec des avantages spéciaux.
     * (Pour extensions futures)
     *
     * @param owner          Propriétaire du compte
     * @param initialDeposit Dépôt initial (minimum 1000€ pour compte premium)
     * @return Le nouveau compte premium créé
     * @throws IllegalArgumentException si le dépôt initial est insuffisant
     */
    public Account createPremiumAccount(User owner, double initialDeposit) {
<span class="fc" id="L78">        validateOwner(owner);</span>
<span class="fc bfc" id="L79" title="All 2 branches covered.">        if (initialDeposit &lt; 1000.0) {</span>
<span class="fc" id="L80">            throw new IllegalArgumentException(</span>
                    &quot;Un compte premium nécessite un dépôt initial d'au moins 1000€&quot;
            );
        }
<span class="fc" id="L84">        validateInitialDeposit(initialDeposit);</span>

<span class="fc" id="L86">        String id = &quot;PRM-&quot; + UUID.randomUUID().toString().substring(0, 8).toUpperCase();</span>
<span class="fc" id="L87">        return new Account(id, owner, initialDeposit);</span>
    }

    /**
     * Valide le propriétaire du compte.
     *
     * @param owner Propriétaire à valider
     * @throws IllegalArgumentException si le propriétaire est invalide
     */
    private void validateOwner(User owner) {
<span class="fc bfc" id="L97" title="All 2 branches covered.">        if (owner == null) {</span>
<span class="fc" id="L98">            throw new IllegalArgumentException(&quot;Le propriétaire du compte ne peut pas être null&quot;);</span>
        }
<span class="pc bpc" id="L100" title="1 of 4 branches missed.">        if (owner.getId() == null || owner.getId().trim().isEmpty()) {</span>
<span class="fc" id="L101">            throw new IllegalArgumentException(&quot;Le propriétaire doit avoir un ID valide&quot;);</span>
        }
<span class="fc" id="L103">    }</span>

    /**
     * Valide le dépôt initial.
     *
     * @param initialDeposit Dépôt à valider
     * @throws IllegalArgumentException si le dépôt est invalide
     */
    private void validateInitialDeposit(double initialDeposit) {
<span class="fc bfc" id="L112" title="All 2 branches covered.">        if (initialDeposit &lt; MIN_INITIAL_DEPOSIT) {</span>
<span class="fc" id="L113">            throw new IllegalArgumentException(</span>
                    &quot;Le dépôt initial ne peut pas être négatif&quot;
            );
        }
<span class="fc bfc" id="L117" title="All 2 branches covered.">        if (initialDeposit &gt; MAX_INITIAL_DEPOSIT) {</span>
<span class="fc" id="L118">            throw new IllegalArgumentException(</span>
                    &quot;Le dépôt initial ne peut pas dépasser &quot; + MAX_INITIAL_DEPOSIT + &quot;€&quot;
            );
        }
<span class="fc" id="L122">    }</span>

    /**
     * Génère un identifiant unique pour le compte.
     *
     * @return Identifiant unique
     */
    private String generateAccountId() {
<span class="fc" id="L130">        return &quot;ACC-&quot; + UUID.randomUUID().toString().substring(0, 8).toUpperCase();</span>
    }
}

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>